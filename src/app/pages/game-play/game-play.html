<div class="w-full h-full flex flex-col relative overflow-hidden">
	<!-- Decorative background bubbles -->
	<app-background-bubbles />

	<!--Ballons Section-->
	<div class="w-full h-[calc(100%-208px)] p-2 md:p-4 lg:p-6 overflow-visible">
		@if (cueFetchingState() === RequestState.LOADING || store.isFetchingFinalTriadCues()) {
			<div class="w-full h-full flex justify-center items-center">
				<span class="w-40 h-40 md:w-48 md:h-48 lg:w-56 lg:h-56 bg-neutral/20 rounded-2xl backdrop-blur-sm">
					<ng-lottie [options]="loadingAnimationOptions" />
				</span>
			</div>
		} @else if (cueFetchingState() === RequestState.READY) {
			<app-bubble-container [cues]="store.cues()" />
		}
	</div>

	<!--Solution Input Section-->
	<div class="w-full h-20 md:h-24 lg:h-28">
		<app-solution-section (whenMovingCueToSolutionBox)="moveToSolvedArea($event)" />
	</div>

	<!--Turn & Hint Section-->
	<div class="w-full h-32 md:h-36 lg:h-40 flex justify-between items-center px-4 md:px-6 lg:px-8">
		<!--Turn Section-->
		<app-turns-box />

		<!--Solved Triads Section-->
		<div #solvedArea class="h-full flex justify-center items-center gap-2">
			@for (solvedTriad of store.solvedTriads(); track solvedTriad.id) {
				<app-solved-triad id="solved-{{ solvedTriad.id }}" [solvedTriad]="solvedTriad" />
			}
		</div>

		<!--Hint Section-->
		<app-hints-box />
	</div>

	<!--Popup Section-->
	@switch (store.gamePlayState()) {
		@case (GamePlayState.CORRECT_ANSWER) {
			<app-answer-dialog [type]="'CORRECT'"> Correct Answer!</app-answer-dialog>
		}
		@case (GamePlayState.WRONG_ANSWER) {
			<app-answer-dialog [type]="'WRONG'">
				Wrong Answer! <br />
				Try Again.
			</app-answer-dialog>
		}
		@case (GamePlayState.WRONG_TRIAD) {
			<app-answer-dialog [type]="'WRONG'">
				Oops! <br />
				{{ availableTurns() }} More {{ availableTurns() <= 1 ? 'Try' : 'Tries' }}.
			</app-answer-dialog>
		}
		@case (GamePlayState.WON) {
			<app-game-result-dialog [result]="'WON'">
				<h2 class="text-success text-4xl font-bold">You Won!</h2>
				<p class="text-base-100 text-lg">Congratulations! You solved all the triads!</p>
				<div class="bg-success/20 rounded-lg px-4 py-2 border border-success/30">
					<p class="text-success font-semibold text-xl">Final Score: {{ store.gameScore() }}</p>
				</div>
			</app-game-result-dialog>
		}
		@case (GamePlayState.LOST) {
			<app-game-result-dialog [result]="'LOST'">
				<h2 class="text-error text-4xl font-bold">Nice Try!</h2>
				<p class="text-base-100 text-lg">You ran out of turns. Better luck next time!</p>
				<div class="bg-error/20 rounded-lg px-4 py-2 border border-error/30">
					<p class="text-error font-semibold text-xl">Final Score: {{ store.gameScore() }}</p>
				</div>
			</app-game-result-dialog>
		}
	}
</div>
