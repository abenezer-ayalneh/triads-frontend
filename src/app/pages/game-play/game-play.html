<div class="w-full h-full flex flex-col relative overflow-hidden">
	<!--Ballons Section-->
	<div class="w-full h-[calc(100%-208px)] p-2 md:p-4 lg:p-6 overflow-visible">
		@if (cueFetchingState() === RequestState.LOADING) {
			<div class="w-full h-full flex justify-center items-center">
				<span class="w-40 h-40 md:w-48 md:h-48 lg:w-56 lg:h-56 bg-neutral/20 rounded-2xl backdrop-blur-sm">
					<ng-lottie [options]="loadingAnimationOptions" />
				</span>
			</div>
		} @else if (cueFetchingState() === RequestState.READY) {
			<app-bubble-container [cues]="visibleCues()" />
		}
	</div>

	<!--Solution Input Section-->
	<div class="w-full h-20 md:h-24 lg:h-28 flex flex-col justify-center items-center">
		<div
			class="w-full h-fit flex-col justify-center items-center px-4 md:px-6 lg:px-8 py-2"
			[class]="{ flex: store.gamePlayState() === GamePlayState.CHECK_SOLUTION, hidden: store.gamePlayState() !== GamePlayState.CHECK_SOLUTION }">
			<button type="button" (click)="checkTriad()" class="w-80 md:w-96 lg:w-[28rem] triad-gradient btn btn-lg border-none text-primary-content">
				Check Solution
			</button>
		</div>

		<div
			class="w-full h-fit flex-col justify-center items-center px-4 md:px-6 lg:px-8 py-2 gap-2"
			[class]="{
				flex: store.gamePlayState() === GamePlayState.ACCEPT_ANSWER || store.gamePlayState() === GamePlayState.WRONG_ANSWER,
				hidden: store.gamePlayState() !== GamePlayState.ACCEPT_ANSWER && store.gamePlayState() !== GamePlayState.WRONG_ANSWER,
			}">
			@if (keywordLengthHint() !== null) {
				<div class="bg-info/20 backdrop-blur-2xl rounded-lg px-4 py-1 heartbeat">
					<p class="text-info-content font-normal text-lg">
						Hint: <span class="font-bold">{{ keywordLengthHint() }}</span> lettered word
					</p>
				</div>
			}
			<div class="w-[80%] md:w-[70%] lg:w-[60%] max-w-3xl h-fit flex justify-center items-center gap-2">
				<input
					#answerField
					[formControl]="answerFormControl"
					placeholder="Answer here..."
					(keydown.enter)="submitAnswer()"
					class="flex-1 h-10 md:h-12 input focus:outline-none text-center placeholder:text-neutral-400 disabled:text-neutral-400 disabled:placeholder:text-neutral-400" />
				<button
					type="button"
					(click)="submitAnswer()"
					[disabled]="!answerFormControl.valid"
					aria-label="Submit answer"
					class="h-10 md:h-12 px-4 md:px-6 rounded-full triad-gradient text-primary-content font-semibold shadow-lg hover:shadow-xl active:scale-95 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
					<svg class="w-4 h-4 md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5-5 5M19 12H5" />
					</svg>
					<span class="hidden sm:inline">Submit</span>
				</button>
			</div>
		</div>
	</div>

	<!--Health & Hint Section-->
	<div class="w-full h-32 md:h-36 lg:h-40 flex justify-between items-center px-4 md:px-6 lg:px-8">
		<!--Health Section-->
		<div
			class="w-fit h-fit flex flex-col justify-center items-center gap-2 border border-base-100/20 shadow-2xl px-4 py-1 rounded-lg bg-neutral/30 backdrop-blur-sm">
			<p class="text-base-300 text-lg md:text-xl font-semibold">Turns</p>
			<div class="w-full flex justify-center items-center gap-1">
				@for (turn of store.turns(); track turn.id) {
					<span class="w-6 h-6 md:w-7 md:h-7 heart" [ngClass]="turn.available ? 'bg-error' : 'bg-base-100/20'"></span>
				}
			</div>
		</div>

		<!--Words Box-->
		<div #box lottie [options]="boxAnimationOptions" (animationCreated)="animationCreated($event)" (click)="toggleBoxStatus()" class="h-full"></div>

		<!--Hint Section-->
		<div
			class="w-fit h-fit flex flex-col justify-center items-center gap-2 border border-base-100/20 shadow-2xl px-4 py-1 rounded-lg bg-neutral/30 backdrop-blur-sm">
			<p class="text-base-300 text-lg md:text-xl font-semibold">Hints</p>
			<div class="w-full flex justify-center items-center gap-1">
				@for (hint of store.hints(); track hint.id) {
					<button class="w-6 h-6 md:w-7 md:h-7 bg-base-100/20 circle" (click)="onHintClick()" [disabled]="!hint.available" aria-label="Use a hint">
						@if (hint.available) {
							<img src="images/lifesaver.svg" alt="hint" />
						}
					</button>
				}
			</div>
		</div>
	</div>

	<!-- Hint Choice Modal -->
	<dialog #hintChoiceModal class="modal modal-bottom sm:modal-middle">
		<div class="modal-box">
			<h3 class="text-lg font-bold">Choose your hint</h3>
			<p class="py-2 text-sm">Pick one of the options below to help solve the Triad.</p>
			<div class="w-full h-fit flex flex-col gap-2 mt-2">
				<button type="button" class="btn btn-info text-base-100" (click)="useHintWithOption('letters')">Number of letters</button>
				<button type="button" class="btn btn-primary text-base-100" (click)="useHintWithOption('firstLetter')">1st letter of word</button>
			</div>

			<div class="modal-action">
				<form method="dialog">
					<button class="btn">Cancel</button>
				</form>
			</div>
		</div>
	</dialog>

	<!--Popup Section-->
	@switch (store.gamePlayState()) {
		@case (GamePlayState.CORRECT_ANSWER) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div class="w-fit h-fit flex flex-col justify-center items-center gap-2 backdrop-blur-xl px-6 py-4 rounded-3xl bg-neutral/30">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="correctAnswerAnimationOptions" />
					</div>
					<p class="text-base-100 text-2xl font-semibold text-pretty text-center">Correct Answer!</p>
				</div>
			</div>
		}
		@case (GamePlayState.WRONG_ANSWER) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div class="w-fit h-fit flex flex-col justify-center items-center gap-2 backdrop-blur-xl px-6 py-4 rounded-3xl bg-neutral/30">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="wrongAnswerAnimationOptions" />
					</div>
					<p class="text-base-100 text-2xl font-semibold text-pretty text-center">
						Wrong Answer! <br />
						Try Again.
					</p>
				</div>
			</div>
		}
		@case (GamePlayState.WRONG_TRIAD) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div class="w-fit h-fit flex flex-col justify-center items-center gap-2 backdrop-blur-xl px-6 py-4 rounded-3xl bg-neutral/30">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="wrongAnswerAnimationOptions" />
					</div>
					<p class="text-base-100 text-2xl font-semibold text-pretty text-center">
						Oops! <br />
						{{ availableTurns() }} More {{ availableTurns() <= 1 ? 'Try' : 'Tries' }}.
					</p>
				</div>
			</div>
		}
		@case (GamePlayState.WON) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div
					class="w-fit h-fit flex flex-col justify-center items-center gap-4 backdrop-blur-xl px-8 py-6 rounded-3xl bg-neutral-900/60 border border-success/50">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="correctAnswerAnimationOptions" />
					</div>
					<div class="text-center space-y-2">
						<h2 class="text-success text-4xl font-bold">You Won!</h2>
						<p class="text-base-100 text-lg">Congratulations! You solved all the triads!</p>
						<div class="bg-success/20 rounded-lg px-4 py-2 border border-success/30">
							<p class="text-success font-semibold text-xl">Final Score: {{ gameScore() }}</p>
						</div>
					</div>
					<button (click)="restartGame()" class="btn btn-info btn-lg text-base-100">Play Again</button>
				</div>
			</div>
		}
		@case (GamePlayState.LOST) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div
					class="w-fit h-fit flex flex-col justify-center items-center gap-4 backdrop-blur-xl px-8 py-6 rounded-3xl bg-neutral-900/60 border border-error/50">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="wrongAnswerAnimationOptions" />
					</div>
					<div class="text-center space-y-2">
						<h2 class="text-error text-4xl font-bold">Nice Try!</h2>
						<p class="text-base-100 text-lg">You ran out of turns. Better luck next time!</p>
						<div class="bg-error/20 rounded-lg px-4 py-2 border border-error/30">
							<p class="text-error font-semibold text-xl">Final Score: {{ gameScore() }}</p>
						</div>
					</div>
					<button (click)="restartGame()" class="btn btn-info btn-lg text-base-100">Play Again</button>
				</div>
			</div>
		}
	}
</div>
