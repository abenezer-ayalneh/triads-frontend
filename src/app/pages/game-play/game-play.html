<div class="w-full h-full flex flex-col relative">
	<!--Ballons Section-->
	<div class="w-full grow px-2 py-6 overflow-hidden">
		@if (cueFetchingState() === RequestState.LOADING) {
			<div class="w-full h-full flex justify-center items-center">
				<span class="w-40 h-40 bg-neutral/20 rounded-2xl backdrop-blur-sm">
					<ng-lottie [options]="loadingAnimationOptions" />
				</span>
			</div>
		} @else if (cueFetchingState() === RequestState.READY) {
			<div #bubblesContainer class="w-full h-full">
				<!--        <app-bubbles-page [cueGroups]="this.store.cueGroups()"/>-->
				<div class="w-full h-full grid grid-cols-3 grid-rows-3">
					@for (cue of visibleCues(); track cue.id) {
						<div class="w-full h-full flex justify-center items-center">
							<app-bubble [cue]="cue" (whenClickedOutput)="bubbleClicked($event)" />
						</div>
					}
				</div>
			</div>
		}
	</div>

	<!--Solution Input Section-->
	<div class="w-full h-20 flex flex-col justify-center items-center">
		<div
			class="w-full h-fit flex-col justify-center items-center px-4 py-2"
			[class]="{ flex: store.gamePlayState() === GamePlayState.CHECK_SOLUTION, hidden: store.gamePlayState() !== GamePlayState.CHECK_SOLUTION }">
			<button type="button" (click)="checkTriad()" class="w-80 triad-gradient btn btn-lg border-none text-primary-content">Check Solution</button>
		</div>

		<div
			class="w-full h-fit flex-col justify-center items-center px-4 py-2"
			[class]="{
				flex: store.gamePlayState() === GamePlayState.ACCEPT_ANSWER || store.gamePlayState() === GamePlayState.WRONG_ANSWER,
				hidden: store.gamePlayState() !== GamePlayState.ACCEPT_ANSWER && store.gamePlayState() !== GamePlayState.WRONG_ANSWER,
			}">
			<div class="w-[80%] h-fit flex justify-center items-center gap-2">
				<input
					#answerField
					[formControl]="answerFormControl"
					placeholder="Answer here..."
					(keydown.enter)="submitAnswer()"
					class="w-full h-10 input focus:outline-none text-center placeholder:text-neutral-400 disabled:text-neutral-400 disabled:placeholder:text-neutral-400" />
			</div>
		</div>
	</div>

	<!--Health & Hint Section-->
	<div class="w-full h-fit flex justify-between items-center px-4 py-2">
		<!--Health Section-->
		<div
			class="w-fit h-fit flex flex-col justify-center items-center gap-2 border border-base-100/20 shadow-2xl px-6 py-2 rounded-lg bg-neutral/30 backdrop-blur-sm">
			<p class="text-base-300 text-lg font-semibold">Turns</p>
			<div class="w-full flex justify-center items-center gap-1">
				@for (turn of store.turns(); track turn.id) {
					<span class="w-6 h-6 heart" [ngClass]="turn.available ? 'bg-error' : 'bg-base-100/20'"></span>
				}
			</div>
		</div>

		<!--Hint Section-->
		<div
			class="w-fit h-fit flex flex-col justify-center items-center gap-2 border border-base-100/20 shadow-2xl px-6 py-2 rounded-lg bg-neutral/30 backdrop-blur-sm">
			<p class="text-base-300 text-lg font-semibold">Hints</p>
			<div class="w-full flex justify-center items-center gap-1">
				@for (hint of store.hints(); track hint.id) {
					<!--TODO: disable the hint buttons if there is no available turn-->
					<button class="w-6 h-6 bg-base-100/20 circle" (click)="hintUseConfirmationModal.showModal()" [disabled]="!hint.available">
						@if (hint.available) {
							<img src="images/lifesaver.svg" alt="hint" />
						}
					</button>
				}
			</div>
		</div>
	</div>

	<!--Popup Section-->
	@switch (store.gamePlayState()) {
		@case (GamePlayState.CORRECT_ANSWER) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div class="w-fit h-fit flex flex-col justify-center items-center gap-2 backdrop-blur-xl px-6 py-4 rounded-3xl bg-neutral/30">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="correctAnswerAnimationOptions" />
					</div>
					<p class="text-base-100 text-2xl font-semibold text-pretty text-center">Correct Answer!</p>
				</div>
			</div>
		}
		@case (GamePlayState.WRONG_ANSWER) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div class="w-fit h-fit flex flex-col justify-center items-center gap-2 backdrop-blur-xl px-6 py-4 rounded-3xl bg-neutral/30">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="wrongAnswerAnimationOptions" />
					</div>
					<p class="text-base-100 text-2xl font-semibold text-pretty text-center">
						Wrong Answer! <br />
						Try Again.
					</p>
				</div>
			</div>
		}
		@case (GamePlayState.WRONG_TRIAD) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div class="w-fit h-fit flex flex-col justify-center items-center gap-2 backdrop-blur-xl px-6 py-4 rounded-3xl bg-neutral/30">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="wrongAnswerAnimationOptions" />
					</div>
					<p class="text-base-100 text-2xl font-semibold text-pretty text-center">
						Oops! <br />
						{{ availableTurns() }} More {{ availableTurns() <= 1 ? 'Try' : 'Tries' }}.
					</p>
				</div>
			</div>
		}
		@case (GamePlayState.WON) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div
					class="w-fit h-fit flex flex-col justify-center items-center gap-4 backdrop-blur-xl px-8 py-6 rounded-3xl bg-neutral-900/60 border border-success/50">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="correctAnswerAnimationOptions" />
					</div>
					<div class="text-center space-y-2">
						<h2 class="text-success text-4xl font-bold">You Won!</h2>
						<p class="text-base-100 text-lg">Congratulations! You solved all the triads!</p>
						<div class="bg-success/20 rounded-lg px-4 py-2 border border-success/30">
							<p class="text-success font-semibold text-xl">Final Score: {{ gameScore() }}</p>
						</div>
					</div>
					<button (click)="restartGame()" class="btn btn-info btn-lg text-base-100">Play Again</button>
				</div>
			</div>
		}
		@case (GamePlayState.LOST) {
			<div class="w-full h-full flex justify-center items-center absolute z-10">
				<div
					class="w-fit h-fit flex flex-col justify-center items-center gap-4 backdrop-blur-xl px-8 py-6 rounded-3xl bg-neutral-900/60 border border-error/50">
					<div class="w-40 h-40 rounded-2xl">
						<ng-lottie [options]="wrongAnswerAnimationOptions" />
					</div>
					<div class="text-center space-y-2">
						<h2 class="text-error text-4xl font-bold">Nice Try!</h2>
						<p class="text-base-100 text-lg">You ran out of turns. Better luck next time!</p>
						<div class="bg-error/20 rounded-lg px-4 py-2 border border-error/30">
							<p class="text-error font-semibold text-xl">Final Score: {{ gameScore() }}</p>
						</div>
					</div>
					<button (click)="restartGame()" class="btn btn-info btn-lg text-base-100">Play Again</button>
				</div>
			</div>
		}
	}
</div>

<!--Hint Use Confirmation Dialog-->
<dialog #hintUseConfirmationModal class="modal modal-bottom sm:modal-middle">
	<div class="modal-box">
		<h3 class="text-lg font-bold">Are you sure?</h3>
		<p class="py-4">Are you sure you want to use a hint? It will cost you one turn.</p>
		<div class="modal-action">
			<form method="dialog">
				<!-- if there is a button in form, it will close the modal -->
				<div class="w-full h-fit flex justify-between items-center gap-4">
					<button class="btn">No</button>
					<button type="button" class="btn" (click)="useHint()">Yes</button>
				</div>
			</form>
		</div>
	</div>
</dialog>
